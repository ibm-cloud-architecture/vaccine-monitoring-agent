apiVersion: appsody.dev/v1beta1
kind: AppsodyApplication
metadata:
  annotations:
    cekit.io/version: 3.7.0
    commit.image.appsody.dev/date: Wed Jan 27 12:55:49 2021 -0600
    commit.image.appsody.dev/message: Merge branch 'dev' of https://github.com/ibm-cloud-architecture/vaccine-monitoring-agent
      into dev
    commit.stack.appsody.dev/contextDir: /experimental/ibm-gse-eda-quarkus
    commit.stack.appsody.dev/date: Sun Jul 19 21:24:37 2020 -0700
    commit.stack.appsody.dev/message: update python stack
    graalvm-archive-filename: graalvm-ce-linux-amd64-20.1.0-java11.tar.gz
    graalvm-archive-url: https://github.com/graalvm/graalvm-ce-builds/releases/download/vm-20.1.0/graalvm-ce-java11-linux-amd64-20.1.0.tar.gz
    graalvm-version: java11-20.1.0
    image.opencontainers.org/created: "2021-01-27T15:39:27-06:00"
    image.opencontainers.org/documentation: https://github.com/ibm-cloud-architecture/vaccine-monitoring-agent
    image.opencontainers.org/revision: 4c905789c14eeda7a46ecee5bdcd09f1648acfd7-modified
    image.opencontainers.org/source: https://github.com/ibm-cloud-architecture/vaccine-monitoring-agent/tree/dev
    image.opencontainers.org/url: https://github.com/ibm-cloud-architecture/vaccine-monitoring-agent
    k8s.io/description: Quarkus.io builder image for building Quarkus applications.
    k8s.io/display-name: Centos + GraalVM + Maven Image
    maintainer: Quarkus Team <quarkus-dev@googlegroups.com>
    openshift.io/expose-services: 8080:http
    openshift.io/tags: builder,java,quarkus
    org/label-schema.build-date: "20200809"
    org/label-schema.license: GPLv2
    org/label-schema.name: CentOS Base Image
    org/label-schema.schema-version: "1.0"
    org/label-schema.vendor: CentOS
    stack.appsody.dev/authors: jerome boyer <>
    stack.appsody.dev/configured: docker.io/ibmcase/ibm-gse-eda-quarkus:1.7.1
    stack.appsody.dev/created: "2020-09-01T17:34:37-07:00"
    stack.appsody.dev/description: Quarkus 1.7.1 runtime for running Java applications,
      kafka 2.5, Event Streams 10
    stack.appsody.dev/digest: sha256:38550f4dc4df3ca2be1017b7e58f877096657e8a70e9a7c6778fee8077e62351
    stack.appsody.dev/documentation: https://github.com/ibm-cloud-architecture/appsody-stacks/tree/master/experimental/ibm-gse-eda-quarkus/README.md
    stack.appsody.dev/licenses: Apache-2.0
    stack.appsody.dev/revision: eb37bd327c8368bd45fad5327485644e1c2cfaf5-modified
    stack.appsody.dev/source: https://github.com/ibm-cloud-architecture/appsody-stacks/tree/master/experimental/ibm-gse-eda-quarkus/image
    stack.appsody.dev/tag: docker.io/ibmcase/ibm-gse-eda-quarkus:1.7.1
    stack.appsody.dev/title: IBM_GSE_EDA_Quarkus
    stack.appsody.dev/url: https://github.com/ibm-cloud-architecture/appsody-stacks/tree/master/experimental/ibm-gse-eda-quarkus
    stack.appsody.dev/vendor: CentOS
  creationTimestamp: null
  labels:
    image.opencontainers.org/title: reefer-monitoring-agent
    stack.appsody.dev/id: ibm-gse-eda-quarkus
    stack.appsody.dev/version: 1.7.1
  name: reefer-monitoring-agent
spec:
  applicationImage: ibmcase/reefer-monitoring-agent:latest
  pullPolicy: Always
  createKnativeService: false
  env:
  - name: POD_IP
    valueFrom:
      fieldRef:
        fieldPath: status.podIP
  - name: QUARKUS_KAFKA_STREAMS_APPLICATION_ID
    valueFrom:
      configMapKeyRef:
        key: consumer-group
        name: agent-cm
  - name: KAFKA_BROKERS
    valueFrom:
      configMapKeyRef:
        key: kafka-brokers
        name: agent-cm
  - name: REEFER_TOPIC
    valueFrom:
      configMapKeyRef:
        key: reefer-topic
        name: agent-cm
  - name: TELEMETRY_TOPIC
    valueFrom:
      configMapKeyRef:
        key: telemetry-topic
        name: agent-cm
  - name: KAFKA_CERT_PATH
    value: /deployments/certs/ca.p12
  - name: KAFKA_CERT_PWD
    valueFrom:
      secretKeyRef:
        key: ca.password
        name: kakfa-cluster-ca-cert
  - name: USER_CERT_PATH
    value: /deployments/certs/user.p12
  - name: USER_CERT_PWD
    valueFrom:
      secretKeyRef:
        key: user.password
        name: kafka-user
  - name: EDA_LOGGING_LEVEL
    value: DEBUG
  expose: true
  livenessProbe:
    failureThreshold: 12
    httpGet:
      path: /health/live
      port: 8080
    initialDelaySeconds: 5
    periodSeconds: 2
  monitoring:
    labels:
      k8s-app: reefer-monitoring-agent
  readinessProbe:
    failureThreshold: 12
    httpGet:
      path: /health/ready
      port: 8080
    initialDelaySeconds: 5
    periodSeconds: 2
    timeoutSeconds: 1
  service:
    port: 8080
    type: NodePort
  stack: ibm-gse-eda-quarkus
  version: 1.0.0
  volumeMounts:
  - mountPath: /deployments/certs/ca.p12
    name: es-cert
    readOnly: true
    subPath: ca.p12
  - mountPath: /deployments/certs/user.p12
    name: user-cert
    readOnly: true
    subPath: user.p12
  volumes:
  - name: es-cert
    secret:
      secretName: kafka-cluster-ca-cert
  - name: user-cert
    secret:
      secretName: app-scram
